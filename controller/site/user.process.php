<?phprequire_once("../../global.php");$action = Filter::text($_POST['action']);if($action == 'edit') {	// assign POST data to variables	$username =  Filter::text($_GET['un']);	$pw = 		 Filter::text($_POST['txtPassword']);	$pw2 = 		 Filter::text($_POST['txtConfirmPassword']);	$email = 	 Filter::email($_POST['txtEmail']);	$name = 	 Filter::text($_POST['txtName']);	$month =     Filter::text($_POST['selBirthMonth']);	$year =      Filter::text($_POST['selBirthYear']);	$sex =		 Filter::text($_POST['selGender']);	$location =  Filter::text($_POST['txtLocation']);	$biography = Filter::formattedText($_POST['txtBiography']);	$user = User::loadByUsername($username);	// make sure user exists	if($user === null) {		$json = array('error' => 'That user does not exist.');		exit(json_encode($json));		}		// new passwords provided?	if($pw != "" || $pw2!= "") {		// do the passwords match?		if($pw != $pw2) {			$json = array( 'error' => 'Sorry, your new passwords do not match.' );			exit(json_encode($json));		}	}		// validate email address	if($email == "")	{		$json = array( 'error' => 'You must provide a valid email address.' );		exit(json_encode($json));	}		if(!Filter::email($email))	{		$json = array( 'error' => 'You must provide a valid email address.' );		exit(json_encode($json));	}			// must provide birthdate	if($month == "0" || $year == "0") {		$json = array( 'error' => 'You must select a valid birth month and year to register.' );		exit(json_encode($json));			}		// convert birthdate to MySQL format	$dob = $year."-".$month."-01";		// required fields		$user->setEmail($email);		if($pw != "") {		// convert password to MD5 hash		$pw = sha1($pw);		$user->setPassword($pw);		}		$user->setDOB($dob);			// optional fields	if($name != '')		$user->setName($name);		$user->setSex($sex);			if($location != '')		$user->setLocation($location);				if($biography != '')		$user->setBiography($biography);			$user->save(); // save the user	// set confirm message and send us to the dashboard	Session::setMessage("Your profile has been updated.");	$json = array( 'success' => '1' );	echo json_encode($json);}